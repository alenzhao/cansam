* Infrastructure for sam::alignment class:

Function                        Non-counted	Reference counted
                                ===========	=================

construct empty                 p(empty)	p(empty), p->refcount++

copy construct                  p(create(other.size)), memcpy(p, other.p)	p(other.p), p->refcount++

destruct                        if (p != empty) destroy(p)	if (--p->refcount <= 0) destroy(p)

assign from another aln         make_new_unshared(other.size), memcpy	oldp = p, p=other.p, p->refcount++,
                                [NO! Buggy, needs to handle self-assignment]	if (--oldp->refcount <= 0) destroy(oldp)

swap                            tmp = p, p = other.p, other.p = tmp	tmp = p, p = other.p, other.p = tmp

assign from elsewhere           make_new_unshared(elsewhere_size), copy from elsewhere	make_new_unshared(elsewhere_size), copy from elsewhere

various mutators                make_unshared_copy(mutated_required_size), make changes	make_unshared_copy(mutated_required_size), make changes

* make_unshared_copy(size)      if (p == empty)	if (p->refcount > 1 || p.capacity < size)
                                    p = create(size), memcpy(p, empty)	    newp = create(size), oldp = p, memcpy(newp, oldp), p = newp,
                                else if (p.capacity < size)	    if (--oldp->refcount <= 0) destroy(oldp)
                                    newp = create(size), oldp = p, memcpy(newp, oldp), p = newp,
                                    destroy(oldp)

* make_new_unshared(size)       if (p == empty)	if (p->refcount > 1 || p.capacity < size)
                                    p = create(size)	    newp = create(size), oldp = p, p = newp,
                                else if (p.capacity < size)	    if (--oldp->refcount <= 0) destroy(oldp)
                                    newp = create(size), oldp = p, p = newp, destroy(oldp)


    vim:set ts=104:


Non-counted assignment
======================


        aln:
this:   EMPTY        OWNED
EMPTY   stet         alloc/copy
OWNED   resize/copy  if_not_this, resize/copy

resize/copy that works even if other==this:

oldp = p
